From: Don Brace <don.brace@microsemi.com>
Date: Thu, 4 May 2017 17:50:58 -0500
Subject: scsi: hpsa: update reset handler
Git-commit: 8516a2db9aec293d983a729c23488acd688fece4
Patch-mainline: v4.13-rc1
References: bsc#1022600 fate#321928

Use the return from TUR as a check for the device state.

Reviewed-by: Scott Benesh <scott.benesh@microsemi.com>
Reviewed-by: Scott Teel <scott.tell@microsemi.com>
Reviewed-by: Kevin Barnett <kevin.barnett@microsemi.com>
Signed-off-by: Don Brace <don.brace@microsemi.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
Acked-by: Martin Wilck <mwilck@suse.com>
---
 drivers/scsi/hpsa.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/drivers/scsi/hpsa.c
+++ b/drivers/scsi/hpsa.c
@@ -3101,7 +3101,7 @@ static int hpsa_do_reset(struct ctlr_inf
 	if (unlikely(rc))
 		atomic_set(&dev->reset_cmds_out, 0);
 	else
-		wait_for_device_to_become_ready(h, scsi3addr, 0);
+		rc = wait_for_device_to_become_ready(h, scsi3addr, 0);
 
 	mutex_unlock(&h->reset_mutex);
 	return rc;
