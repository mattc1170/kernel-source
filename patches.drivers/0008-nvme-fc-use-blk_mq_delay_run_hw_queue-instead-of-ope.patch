From: Sagi Grimberg <sagi@grimberg.me>
Date: Tue, 4 Jul 2017 10:18:50 +0300
Subject: nvme-fc: use blk_mq_delay_run_hw_queue instead of open-coding it
Git-commit: e5859d3a0ea07bf948f4538d47fe6547f6e115be
Patch-Mainline: v4.13
References: bsc#1052384

Cc: James Smart <james.smart@broadcom.com>
Signed-off-by: Sagi Grimberg <sagi@grimberg.me>
Signed-off-by: Hannes Reinecke <hare@suse.de>
---
 drivers/nvme/host/fc.c | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/drivers/nvme/host/fc.c b/drivers/nvme/host/fc.c
index 54cc6b8..eeb5739 100644
--- a/drivers/nvme/host/fc.c
+++ b/drivers/nvme/host/fc.c
@@ -2234,10 +2234,9 @@ nvme_fc_start_fcp_op(struct nvme_fc_ctrl *ctrl, struct nvme_fc_queue *queue,
 		if (ret != -EBUSY)
 			return BLK_MQ_RQ_QUEUE_ERROR;
 
-		if (op->rq) {
-			blk_mq_stop_hw_queues(op->rq->q);
-			blk_mq_delay_queue(queue->hctx, NVMEFC_QUEUE_DELAY);
-		}
+		if (op->rq)
+			blk_mq_delay_run_hw_queue(queue->hctx, NVMEFC_QUEUE_DELAY);
+
 		return BLK_MQ_RQ_QUEUE_BUSY;
 	}
 
-- 
1.8.5.6

