From: "Yan, Zheng" <zyan@redhat.com>
Date: Mon, 28 Aug 2017 15:02:42 +0800
Subject: ceph: fix NULL pointer dereference in ceph_flush_snaps()
Git-commit: c858a0709f991171256db74f4329a1cb8e823764
Patch-mainline: v4.14-rc1
References: bsc#1061451

Signed-off-by: "Yan, Zheng" <zyan@redhat.com>
Signed-off-by: Ilya Dryomov <idryomov@gmail.com>
Acked-by: Luis Henriques <lhenriques@suse.com>
---
 fs/ceph/caps.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

--- a/fs/ceph/caps.c
+++ b/fs/ceph/caps.c
@@ -1460,7 +1460,7 @@ out:
 
 	if (psession) {
 		*psession = session;
-	} else {
+	} else if (session) {
 		mutex_unlock(&session->s_mutex);
 		ceph_put_mds_session(session);
 	}
