From 01ab21332a5146bcd4df4da319d98e4a3b4903f0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Micha=C5=82=20Winiarski?= <michal.winiarski@intel.com>
Date: Fri, 19 Sep 2014 19:52:10 +0200
Subject: [PATCH 067/143] [VPG]: drm/i915: Add RCS General Purpose Registers to parser whitelist
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

These registers are used as a temporary storage by MI_MATH command when
performing ALU operations.

Change-Id: I17362bbfd33e90d77449f24405f5d253fdc8fd99
Signed-off-by: Micha≈Ç Winiarski <michal.winiarski@intel.com>
---
 drivers/gpu/drm/i915/i915_cmd_parser.c |   16 ++++++++++++++++
 drivers/gpu/drm/i915/i915_reg.h        |    3 +++
 2 files changed, 19 insertions(+), 0 deletions(-)

diff --git a/drivers/gpu/drm/i915/i915_cmd_parser.c b/drivers/gpu/drm/i915/i915_cmd_parser.c
index 6908ce7..39795ee 100644
--- a/drivers/gpu/drm/i915/i915_cmd_parser.c
+++ b/drivers/gpu/drm/i915/i915_cmd_parser.c
@@ -451,6 +451,22 @@ static const struct drm_i915_reg_descriptor gen7_render_regs[] = {
 	REG32(GEN7_GPGPU_DISPATCHDIMX),
 	REG32(GEN7_GPGPU_DISPATCHDIMY),
 	REG32(GEN7_GPGPU_DISPATCHDIMZ),
+	REG64(CS_GPR(0)),
+	REG64(CS_GPR(1)),
+	REG64(CS_GPR(2)),
+	REG64(CS_GPR(3)),
+	REG64(CS_GPR(4)),
+	REG64(CS_GPR(5)),
+	REG64(CS_GPR(6)),
+	REG64(CS_GPR(7)),
+	REG64(CS_GPR(8)),
+	REG64(CS_GPR(9)),
+	REG64(CS_GPR(10)),
+	REG64(CS_GPR(11)),
+	REG64(CS_GPR(12)),
+	REG64(CS_GPR(13)),
+	REG64(CS_GPR(14)),
+	REG64(CS_GPR(15)),
 	REG32(GEN7_LRA_LIMITS(1)),
 	REG64(GEN7_SO_NUM_PRIMS_WRITTEN(0)),
 	REG64(GEN7_SO_NUM_PRIMS_WRITTEN(1)),
diff --git a/drivers/gpu/drm/i915/i915_reg.h b/drivers/gpu/drm/i915/i915_reg.h
index bc7b8fa..43ada30 100644
--- a/drivers/gpu/drm/i915/i915_reg.h
+++ b/drivers/gpu/drm/i915/i915_reg.h
@@ -542,6 +542,9 @@
 
 #define OACONTROL 0x2360
 
+/* There are 16 64-bit RCS general purpose registers used by MI_MATH */
+#define CS_GPR(i) (0x2600 + (i) * 8)
+
 #define _GEN7_PIPEA_DE_LOAD_SL	0x70068
 #define _GEN7_PIPEB_DE_LOAD_SL	0x71068
 #define GEN7_PIPE_DE_LOAD_SL(pipe) _PIPE(pipe, \
-- 
1.7.1

